---
title: "Introduction"
author: "Michael Bedward"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---



```{r}

set.seed(42)

ncircles <- 200
limits <- c(-50, 50)
inset <- diff(limits) / 3
rmax <- 20

xyr <- data.frame(
  x = runif(ncircles, min(limits) + inset, max(limits) - inset),
  y = runif(ncircles, min(limits) + inset, max(limits) - inset),
  r = rbeta(ncircles, 1, 10) * rmax)
```

Next, we use the `circleRepelLayout` function to try to find a non-overlapping
arragement, allowing the circles to occupy any part of the bounding square.
The returned value is a list with elements for the layout and the number
of iterations performed.

```{r}
library(packcircles)

res <- circleRepelLayout(xyr, limits, limits, maxiter = 1000)
cat(res$niter, "iterations performed")

```

Now we can use ggplot to draw the before and after layouts.

```{r, fig.width=7, fig.height=4}
library(ggplot2)

t <- theme_bw() +
  theme(panel.grid = element_blank(),
        axis.text=element_blank(),
        axis.ticks=element_blank(),
        axis.title=element_blank())

theme_set(t)


## plot data for the `before` layout
dat.before <- circlePlotData(xyr)

## plot dta for the `after` layout returned by circleRepelLayout
dat.after <- circlePlotData(res$layout)

dat <- rbind(
  cbind(dat.before, label = "before"),
  cbind(dat.after, label = "after")
)

ggplot(data = dat, aes(x, y, group = id)) +
  geom_polygon(colour="brown", fill="burlywood", alpha=0.3) +
  coord_equal(xlim=limits, ylim=limits) +
  facet_wrap(~ label)

```

## Moving and fixed circles

The `circleRepelLayout` function accepts an optional `weights` argument to give extra control over the movement of circles at each iteration of the layout algorithm. The argument takes a numeric vector with values in the range 0-1 inclusive (any values outside this range will be clamped to 0 or 1). A weight of 0 prevents a circle from moving at all while a weight of 1 allows full movement.

To illustrate this, let's anchor the largest circle in the `xyr` data.frame:

```{r, fig.width=7, fig.height=4}
largest.id <- which(xyr$r == max(xyr$r))

# add a column to the previously generated plot data for the 'before' circles
dat.before$state <- ifelse(dat.before$id == largest.id, "static", "free")

# now re-run the layout algorithm with a weights vector to fix the position
# of the largest circle
wts <- rep(1.0, nrow(xyr))
wts[ largest.id ] <- 0.0

res <- circleRepelLayout(xyr, limits, limits, maxiter = 1000, weights=wts)

dat.after <- circlePlotData(res$layout)
dat.after$state <- ifelse(dat.after$id == largest.id, "static", "free")

dat <- rbind(
  cbind(dat.before, label = "before"),
  cbind(dat.after, label = "after")
)

ggplot(data = dat, aes(x, y, group=id, fill=state)) + 
  geom_polygon(colour="brown1", show.legend = FALSE) +
  scale_fill_manual(values=c("NA", "brown4")) +
  coord_equal(xlim=limits, ylim=limits) +
  facet_wrap(~label)

```

